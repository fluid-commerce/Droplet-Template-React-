# Render deployment configuration for Fluid Droplet Template
# Updated: September 22, 2025 - Fixed project structure and build commands

services:
  # Frontend service (React app)
  - type: web
    name: droplet-template-frontend
    env: static
    buildCommand: npm install && npm run build:frontend
    staticPublishPath: ./frontend/dist
    envVars:
      # Backend API Configuration
      - key: VITE_API_BASE_URL
        value: https://droplet-template-backend.onrender.com
      
      # Fluid Platform Configuration
      - key: VITE_FLUID_API_URL
        value: https://api.fluid.app
      - key: VITE_FLUID_ENVIRONMENT
        value: production
      
      # Optional: Custom configuration
      - key: VITE_APP_NAME
        sync: false  # Set your app name in Render dashboard
      - key: VITE_APP_VERSION
        sync: false  # Set your app version in Render dashboard

  # Backend service (Node.js API)
  - type: web
    name: droplet-template-backend
    env: node
    buildCommand: cd backend && npm install && npm run build && npm run db:push
    startCommand: cd backend && node dist/index.js
    # Backend service with organized structure - Fixed startup command
    # All backend files are in the backend/ directory
    envVars:
      # Server Configuration
      - key: NODE_ENV
        value: production
      - key: NPM_CONFIG_PRODUCTION
        value: "false"  # Install devDependencies (TypeScript, @types/node) during build
      - key: PORT
        value: 10000
      
      # Frontend URL (for CORS)
      - key: FRONTEND_URL
        sync: false  # Set to your frontend service URL in Render dashboard
      
      # Fluid Platform Configuration (Builder's API Key)
      - key: FLUID_API_KEY
        sync: false  # Set this in Render dashboard - YOUR builder API key
      - key: DROPLET_ID
        sync: false  # Set your droplet UUID in Render dashboard
      - key: FLUID_API_URL
        value: https://api.fluid.app
      - key: FLUID_WEBHOOK_SECRET
        sync: false  # Set this in Render dashboard
      - key: WEBHOOK_BASE_URL
        sync: false  # Set to your backend service URL in Render dashboard
      
      # External Service API Credentials (for connecting to external services)
      # Add your own external service API keys here as needed
      # Examples (uncomment and set in Render dashboard if using these services):
      # - key: SHOPIFY_API_KEY
      #   sync: false
      # - key: STRIPE_API_KEY
      #   sync: false
      
      # Database Configuration (will be set automatically by Render)
      - key: DATABASE_URL
        fromDatabase:
          name: droplet-template-db
          property: connectionString
      
      # Logging
      - key: LOG_LEVEL
        value: info
      
      # Security (auto-generated)
      - key: JWT_SECRET
        generateValue: true
      
      # Optional: External Service URLs
      - key: EXTERNAL_SERVICE_BASE_URL
        sync: false  # Set your external service API URL in Render dashboard

      # Email (from backend env.example)
      - key: RESEND_API_KEY
        sync: false  # Set in Render dashboard
      - key: RESEND_FROM_EMAIL
        sync: false  # Set in Render dashboard

databases:
  # PostgreSQL database for storing configurations and data
  - name: droplet-template-db
    databaseName: droplet_db
    user: droplet_user
    plan: Basic-256mb
    # Exact resources per request
    ram: 256 MB
    cpu: 0.1
    storage: 1 GB
